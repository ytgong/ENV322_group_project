---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "A Case Study on Chemical Flashiness of Streams and Canals in Florida"
subtitle: "https://github.com/ytgong/ENV322_group_project"
author: "Ethan Ready, Gabi Richichi, Theo Cai, Yutao Gong"
fontsize: 12pt
mainfont: Times New Roman

---

\newpage

<Arrow brackets are used for annotating the RMarkdown files. Text within these brackets should not appear in the final version of the PDF document>

<**General Guidelines**>
<1. Write in scientific style> 
<2. [Global options for R chunks](https://rmarkdown.rstudio.com/lesson-3.html) should be set so that only relevant output is displayed>
<3. Make sure your final knitted PDF looks professional. Format tables appropriately, size figures appropriately, make sure bulleted and numbered lists appear as such, avoid awkwardly placed page breaks, etc.>

```{r setup, include=FALSE}
# Set your working directory
library(dataRetrieval)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(knitr)
library(sf)
library(maps)
library(cowplot)
library(gridExtra)
library(grid)

#Set theme
theme_set(theme_bw())

# Load your datasets

hyp2.full_cleaned = read.csv("../Processed_Dataframes/hyp2+chemo.csv")
```


# Rationale and Research Questions

<Write 1-2 paragraph(s) detailing the rationale for your study. This should include both the context of the topic as well as a rationale for your choice of dataset (reason for location, variables, etc.) A few citations should be included to give context for your topic. You may choose to configure autoreferencing for your citations or add these manually.>

<At the end of your rationale, introduce a numbered list of your questions (or an overarching question and sub-questions). Each question should be accompanied by one or more working hypotheses, inserted beneath each question.>

Each time a storm event occurs, it has the potential to influence the land and waterways with which it comes in contact. A storm can bring high levels of precipitation that can flood rivers and streams and temporarily alter their discharge levels. The precipitation can also alter the biogeochemistry of water bodies: eroding soil, increasing terrestrial inputs of organic matter, and transporting in contaminants such as pesticides and fertilizers. Alterations to the natural processes of streams impact the ecosystems present in the streams and can affect human activity such as hunting, fishing, recreation, and the utilization of river water for irrigation. Eutrophication is one example of a massive alteration to a river that can have negative consequences for people. Eutrophication is the induction of a dead zone devoid of oxygen in a body of water due to nutrient loading from a storm event.

  The effects of storm events on bodies of water are compounded by human activity. The use of pesticides and fertilizers on agricultural land makes nutrients such as nitrogen and phosphorus accessible for storm transport in the first place. Furthermore, anthropogenically-induced climate change is intensifying natural precipitation events by making them wetter, longer, and more intense. As storms worsen, so do their effects. 
	
	This applies to the region we are studying in particular. Florida is a state that has a history of extreme weather events such as hurricanes and tropical storms, as well as a history, particularly recently, of eutrophication events. High levels of nutrient loading, in combination with high temperatures that are typical of Florida’s climate, creates an environment conducive to eutrophication (Stephenson, 2018). The Florida Department of Environmental Protection lists more than 1,400 water bodies as “impaired by pollutants” (Stephenson, 2018). 
	
	It is important for us to understand the science behind the interaction of storms and streams in order to protect ourselves from the consequences on human activity of storm events. As eutrophication events worsen and hinder human activities such as fishing, hunting, recreation, and irrigation, policymakers will enact legislation to tackle the problem. In Florida, for example, policymakers have enacted legislation to tackle point sources of nutrient discharge. Nevertheless, eutrophication still abounds (Smith & Schindler 2009). As a result, it is crucial that the problem be understood more explicitly in order for policies to be more targeted and effective. How do storm events affect the chemostaticity and hydrologic flashiness of rivers in Florida? Which rivers are the most affected? What factors influence the flashiness during storm events? These are questions to which we need answers in order to affect change. 

Our research questions are:

  What, if any, is the correlation between hydrologic flashiness and chemical flashiness in Florida?

  What aspects of a stream influence chemical flashiness in Florida?

  What aspects of a storm influence chemical flashiness in Florida?

\newpage

# Dataset Information

<Provide information on how the dataset for this analysis were collected, the data contained in the dataset, and any important pieces of information that are relevant to your analyses. This section should contain much of same information as the metadata file for the dataset but formatted in a way that is more narrative.>

<Describe how your team wrangled your dataset in a format similar to a methods section of a journal article.>

<Add a table that summarizes your data structure (variables, units, ranges and/or central tendencies, data source if multiple are used, etc.). This table can be made in markdown text or inserted as a `kable` function in an R chunk. If the latter, do not include the code used to generate your table.>

For this analysis, our datasets were USGS NWIS high frequency and water use data. The data contained in our datasets for hypothesis 1 are the site number, date/time of measurement, instantaneous discharge, and instantaneous nitrate. Contained in the datasets for hypothesis 2 and 3 are site number, date/time of measurement, instantaneous discharge, nitrate, pH, dissolved oxygen, specific conductance; population of the county each site is in, and the amount of surface water used for thermoelectric, industrial, livestock and irrigation uses in each county. We wrangled all our data frames to include periods of data that included all of the variables, and that exhibited the most continuous measurements - all for easier, more standardized analysis and visualization. We chose sites from the state of Florida because it had sufficient sites with high frequency nitrate and discharge data.

```{r, echo = FALSE, message = FALSE}
df <- data.frame(Variable = c("Nitrate concentrations -- high frequency","Discharge -- high frequency","Richards-Baker Index value", "County population", "Irrigation water use", "Thermoelectric water use", "Chemostatic coefficient"),
                 Units = c("ng/L","m^3/s","", "k people", "Bgal/day", "Bgal/day",""),
                 Type = c("Independent","Independent","Independent","Independent","Independent","Independent","Dependent")
)

kable(df, caption = "Variables used for analysis")

df2 = read.csv("../Processed_Dataframes/siteinfo.csv") %>%
  select("Site No." = site_no,
         "Station Name" = station_nm,
         "County" = county_nm)

kable(df2, caption = "USGS sites selected for analysis") 
```

\newpage

# Exploratory Analysis 

<Insert exploratory visualizations of your dataset. This may include, but is not limited to, graphs illustrating the distributions of variables of interest and/or maps of the spatial context of your dataset. Format your R chunks so that graphs are displayed but code is not displayed. Accompany these graphs with text sections that describe the visualizations and provide context for further analyses.>

<Each figure should be accompanied by a caption, and each figure should be referenced within the text>

```{r, include = FALSE}
waterfeatures <- st_read("../other_data/hydrogl020.dbf")
waterfeatures <- filter(waterfeatures, STATE == "FL")
waterfeatures <- filter(waterfeatures, FEATURE != "Apparent Limit" & FEATURE != "Closure Line")
HUC6 <- st_read("../other_data/WBDHU6.dbf")
HUC6.Florida <- HUC6 %>%
  filter(States %in% c("AL,FL", "FL", "FL,GA", "AL,FL,GA"))
waterfeatures <- st_set_crs(waterfeatures, 4269)
states<- st_as_sf(map(database = "state", plot = TRUE, fill = TRUE, col = "white")) 
states.florida = filter(states, ID %in% c("florida"))
hyp2.spatial <- st_as_sf(hyp2.full_cleaned, coords = c("dec_long_va", "dec_lat_va"), crs = 4326)
```

```{r, echo = FALSE, message = FALSE, fig.cap="Location of sites analyzed on watersheds",fig.height=4.5}
plot.exp <- ggplot() +
  geom_sf(data = HUC6.Florida, color = "darkgray", alpha = 0.5)+
  geom_sf(data = waterfeatures, aes(fill = FEATURE, color = FEATURE)) +
  geom_sf(data = hyp2.spatial, alpha = 0.5) +
 # scale_color_viridis_c(option = "inferno") +
  labs(size = "Chemo staticity") +
  theme(legend.position = "right",
        legend.text = element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.margin = margin(0,0,0,0))
print(plot.exp)
```

\newpage

# Analysis

<Insert visualizations and text describing your main analyses. Format your R chunks so that graphs are displayed but code and other output is not displayed. Instead, describe the results of any statistical tests in the main text (e.g., "Variable x was significantly different among y groups (ANOVA; df = 300, F = 5.55, p < 0.0001)"). Each paragraph, accompanied by one or more visualizations, should describe the major findings and how they relate to the question and hypotheses. Divide this section into subsections, one for each research question.>

<Each figure should be accompanied by a caption, and each figure should be referenced within the text>

## Question 1: <insert specific question here and add additional subsections for additional questions below> Are sites with high hydrologic flashiness more or less likely to have high chemical flashiness?

We chose to analyze our first question, on the relationship between hydrologic flashiness and chemical flashiness, using sites with high frequency nitrate and discharge measurements. At each site, we calculated the Richards-Baker Index to quantify the hydrologic flashiness.

We had to exclude catchment size in the formula because 17/21 sites did not have a recorded catchment size.

To quantify chemical flashiness, we ran a linear regression between mean daily nitrate and mean daily discharge values and took the coefficient as our chemostaticity value. We excluded 3 sites with poor linear regression fits, 1 of which had a large outlier for chemostaticity coefficient.

We wrangled the RBI values and Chemostaticity Coefficients to create a dataframe with columns site, site type(canal, river, etc.), chemostaticity coefficient, chemostaticity coefficient absolute value, and RBI value. We included the absolute value of the Chemostaticity Coefficient to investigate the flashiness, as absolute value would account for large chemostaticity in either a flushing or diluting system.

```{r, include = FALSE}
# read in data from RBI_CHEMO_analysis doc
RBI_CHEMO_data<-read_csv("../Processed_Dataframes/RBI_CHEMO_data.csv")
RBI_nocanals<-read_csv("../Processed_Dataframes/RBI_CHEMO_nocanals.csv")  
```

We created ggplot visualizations of Chemostaticity Coefficient vs. RBI and |Chemostaticity Coefficient vs. RBI| separating site type by color. The visualization without absolute value shows a distribution that follows the x and y axis. Sites with large RBI values have low Chemostatic Coefficients, and sites with low RBI values have Chemostatic Coefficients that are far above 0 or far below 0. The absolute value visualization reinforces this finding, as large absolute Chemostatic Coefficients correspond with small RBI values. Similar trends were viewed between site type, except that the largest outlier for both Chemostatic Coefficient and RBI are both canals.

```{r, echo = FALSE, message = FALSE, fig.cap="Chemostatic coefficient values and Richards-Baker Index of 18 sites", fig.height=3}

#visualize data, both abs and non-abs
RBI.linear<-ggplot(RBI_CHEMO_data, 
                   aes(x=RBI_value_ind_noncatch, y=chemo.coef))+
  geom_point(aes(color=site.type))+
  labs(x="Richards-Baker Index", y="Chemostatic Coefficient")
print(RBI.linear)
```


```{r, echo = FALSE, message = FALSE, fig.cap="Absolute Chemostatic coefficient values and Richards-Baker Index of 18 sites",fig.height=3}
RBI.linear.abs<-ggplot(RBI_CHEMO_data, 
                       aes(x=RBI_value_ind_noncatch, y=chemo.coef.abs))+
  geom_point(aes(color=site.type))+
  labs(x="Richards-Baker Index", 
       y=" Absolute Chemostatic Coefficient")
print(RBI.linear.abs)

```

We ran a linear regression on log(Absolute Chemostaticity Coefficient) vs. RBI, which was the closest fit that we could find. The regression produced a coefficient of -2.6847 , a P-value of 0.473, and a multiple r-squared of 0.03264. The model does not adequately predict the data.

```{r, echo = FALSE, message = FALSE}
# run regressions on data

lm_sig_log_abs<-lm(log(chemo.coef.abs)~RBI_value_ind_noncatch, RBI_CHEMO_data)

summary(lm_sig_log_abs)
```

Since canals often act differently than natural waterways, and the largest outlier for both RBI and Chemostaticity Coefficient are canals, we also visualized the data without canals. The visualizations are more clear due to smaller axis ranges, and show similar results to the first visualizations. We ran the same linear regression on the Absolute Chemostatic Coefficient without canals.

```{r, echo = FALSE, message = FALSE, fig.cap="Absolute Chemostatic coefficient values and Richards-Baker Index of 14 non-canal sites",fig.height=3}
#same analysis, without canals in the data
Nocanals.linear.abs<-ggplot(RBI_nocanals, 
                            aes(x=RBI_value_ind_noncatch, y=chemo.coef.abs))+
  geom_point(aes(color=site.type))+
  geom_smooth(method="lm", se=TRUE)+
  labs(x="Richards-Baker Index",
       y="Absolute Chemostatic Coefficient")

print(Nocanals.linear.abs)
lm_nocanals_log_abs<-
  lm(log(chemo.coef.abs)~RBI_value_ind_noncatch, RBI_nocanals)
summary(lm_nocanals_log_abs)
```

The linear regression for Absolute Chemostatic Coefficient vs. RBI provided a Coefficient of -6.889, a P-value of 0.39, and a multiple r-squared of 0.06228. While the fit doesn’t sufficiently match the data, it is better than the data with canals and does provide some idea of the relationship between the variables.


## Question 2: How do features of a site impact its chemical flashiness?

### Qualitative Approach: How do geographical features impact the site’s chemical flashiness?

We made observations by first sorting sites into three categories - Chemostatic, Flushing, and Diluting - based on the slopes of the regression lines of their C-Q plots - values near 0, positive values, and negative values, respectively. Then, we went site by site and searched their coordinates into Google Maps and ArcGIS, and noted the general surrounding geography - is it mostly urban or rural? Is it in a state park, adjacent to it, or nowhere near? Where, generally, in Florida is this site located? We also paid special attention to the site type - river, spring, or canal - as each most likely have differing management strategies and hydrologies.

When we were done listing the qualitative traits of all the sites in each hydrologic behavioral categorical, we noticed some trends had emerged. For the most flushing sites, or, the ones with the steepest regression line slopes, we noticed that all are located near airports. (Main Canal, Fellsmere Canal, Crane Creek, and Madison Blue Spring) There does not seem to be a correlation with the urbanity of the location, however, as two out of four of these sites are mostly rural and two are mostly urban - Fellsmere, Madison Blue Spring and Main Canal, Crane Creek, respectively. We hesitate to draw any concrete conclusions about possible relationships between flushing systems and proximity to airports, as there may be many other factors involved that are not within the scope of this project. One important factor could be the management style of the site; three out of four of the canals analyzed in this project tend towards flushing. This, too, could be a coincidence, and we would need to do a deeper analysis with more sites to draw conclusions.
Our list of diluting sites show more convincing trends - seven out of nine of the sites are located in very rural locations, most in or on the edge of a Florida state park. (Ichetucknee, Santa Fe, Blue Spring, Blue Hole Spring, Manatee Spring, Homosassa Spring, Turkey Creek) However, this number may be slightly inflated because three of the four most diluting sites are directly interconnected, increasing the likelihood of similar hydrologic tendencies between them. (Ichetucknee, Santa Fe, Blue Hole Spring) There seem to be no other notable qualitative trends for diluting sites.
Chemostatic or mostly chemostatic systems do not seem to display any particular kind of trend. They are located in all kinds of environments - from hyper-urban to deep in state parks.

```{r, include = FALSE, warning= FALSE, message = FALSE, echo = FALSE}
#Blue
BLUEdata <- read.csv("../FL_CSV/hyp1/BLUEdata.csv")

BLUENitrateDV <- BLUEdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

BLUEFlowDV <- BLUEdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

BLUEChemo <- full_join(BLUENitrateDV, BLUEFlowDV, by = "dateTime")

BLUEChemoplot <- ggplot(BLUEChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Blue Springs") +
  theme(plot.title = element_text(size = 12))

#BOW
BOWdata <- read.csv("../FL_CSV/hyp1/BOWdata.csv")

BOWNitrateDV <- BOWdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

BOWFlowDV <- BOWdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

BOWChemo <- full_join(BOWNitrateDV, BOWFlowDV, by = "dateTime")

BOWChemoplot <- ggplot(BOWChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  
  labs(x = "", y = "") +
  ggtitle("Rainbow River \n Near Dunnellon")+
  theme(plot.title = element_text(size = 12))


#CAL
CALdata <- read.csv("../FL_CSV/hyp1/CALdata.csv")

CALNitrateDV <- CALdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

CALFlowDV <- CALdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

CALChemo <- full_join(CALNitrateDV, CALFlowDV, by = "dateTime")

CALChemoplot <- ggplot(CALChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Caloosahatchee River")+
  theme(plot.title = element_text(size = 12))


#CHAS
CHASdata <- read.csv("../FL_CSV/hyp1/CHASdata.csv")

CHASNitrateDV <- CHASdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

CHASFlowDV <- CHASdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

CHASChemo <- full_join(CHASNitrateDV, CHASFlowDV, by = "dateTime")

CHASChemoplot <- ggplot(CHASChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Chassahowitzka River")+
  theme(plot.title = element_text(size = 12))


#CRANE
CRANEdata <- read.csv("../FL_CSV/hyp1/CRANEdata.csv")

CRANENitrateDV <- CRANEdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

CRANEFlowDV <- CRANEdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

CRANEChemo <- full_join(CRANENitrateDV, CRANEFlowDV, by = "dateTime")

CRANEChemoplot <- ggplot(CRANEChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Crane Creek")+
  theme(plot.title = element_text(size = 12))

#DRAIN
DRAINdata <- read.csv("../FL_CSV/hyp1/DRAINdata.csv")

DRAINNitrateDV <- DRAINdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

DRAINFlowDV <- DRAINdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

DRAINChemo <- full_join(DRAINNitrateDV, DRAINFlowDV, by = "dateTime")

DRAINChemoplot <- ggplot(DRAINChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Drainage Canal")+
  theme(plot.title = element_text(size = 12))
  

#FAN
FANdata <- read.csv("../FL_CSV/hyp1/FANdata.csv")

FANNitrateDV <- FANdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

FANFlowDV <- FANdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

FANChemo <- full_join(FANNitrateDV, FANFlowDV, by = "dateTime")

FANChemoplot <- ggplot(FANChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Fanning Springs")+
  theme(plot.title = element_text(size = 12))


#FELL
FELLdata <- read.csv("../FL_CSV/hyp1/FELLdata.csv")

FELLNitrateDV <- FELLdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

FELLFlowDV <- FELLdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

FELLChemo <- full_join(FELLNitrateDV, FELLFlowDV, by = "dateTime")

FELLChemoplot <- ggplot(FELLChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Fellsmere Canal")+
  theme(plot.title = element_text(size = 12))


#HOL
HOLdata <- read.csv("../FL_CSV/hyp1/HOLdata.csv")

HOLNitrateDV <- HOLdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

HOLFlowDV <- HOLdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

HOLChemo <- full_join(HOLNitrateDV, HOLFlowDV, by = "dateTime")

HOLChemoplot <- ggplot(HOLChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Blue Hole Spring")+
  theme(plot.title = element_text(size = 12))


#HOM
HOMdata <- read.csv("../FL_CSV/hyp1/HOMdata.csv")

HOMNitrateDV <- HOMdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

HOMFlowDV <- HOMdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

HOMChemo <- full_join(HOMNitrateDV, HOMFlowDV, by = "dateTime")

HOMChemoplot <- ggplot(HOMChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Homosassa Springs")+
  theme(plot.title = element_text(size = 12))


#HUN
HUNdata <- read.csv("../FL_CSV/hyp1/HUNdata.csv")

HUNNitrateDV <- HUNdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

HUNFlowDV <- HUNdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

HUNChemo <- full_join(HUNNitrateDV, HUNFlowDV, by = "dateTime")

HUNChemoplot <- ggplot(HUNChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Hunter Spring Run")+
  theme(plot.title = element_text(size = 12))


#ICHE
ICHEdata <- read.csv("../FL_CSV/hyp1/ICHEdata.csv")

ICHENitrateDV <- ICHEdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

ICHEFlowDV <- ICHEdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

ICHEChemo <- full_join(ICHENitrateDV, ICHEFlowDV, by = "dateTime")

ICHEChemoplot <- ggplot(ICHEChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Ichetucknee River")+
  theme(plot.title = element_text(size = 12))


#MAD
MADdata <- read.csv("../FL_CSV/hyp1/MADdata.csv")

MADNitrateDV <- MADdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

MADFlowDV <- MADdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

MADChemo <- full_join(MADNitrateDV, MADFlowDV, by = "dateTime")

MADChemoplot <- ggplot(MADChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Madison Blue Spring")+
  theme(plot.title = element_text(size = 12))


#MAIN
MAINdata <- read.csv("../FL_CSV/hyp1/MAINdata.csv")

MAINNitrateDV <- MAINdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

MAINFlowDV <- MAINdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

MAINChemo <- full_join(MAINNitrateDV, MAINFlowDV, by = "dateTime")

MAINChemoplot <- ggplot(MAINChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Main Canal")+
  theme(plot.title = element_text(size = 12))


#MAN
MANdata <- read.csv("../FL_CSV/hyp1/MANdata.csv")

MANNitrateDV <- MANdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

MANFlowDV <- MANdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

MANChemo <- full_join(MANNitrateDV, MANFlowDV, by = "dateTime")

MANChemoplot <- ggplot(MANChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Manatee Spring")+
  theme(plot.title = element_text(size = 12))


#RAIN
RAINdata <- read.csv("../FL_CSV/hyp1/RAINdata.csv")

RAINNitrateDV <- RAINdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

RAINFlowDV <- RAINdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

RAINChemo <- full_join(RAINNitrateDV, RAINFlowDV, by = "dateTime")

RAINChemoplot <- ggplot(RAINChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  
  labs(x = "", y = "") +
  ggtitle("Rainbow River at Dunnellon")+
  theme(plot.title = element_text(size = 12))


#SANTA
SANTAdata <- read.csv("../FL_CSV/hyp1/SANTAdata.csv")

SANTANitrateDV <- SANTAdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

SANTAFlowDV <- SANTAdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

SANTAChemo <- full_join(SANTANitrateDV, SANTAFlowDV, by = "dateTime")

SANTAChemoplot <- ggplot(SANTAChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Santa Fe River")+
  theme(plot.title = element_text(size = 12))



#THREE
THREEdata <- read.csv("../FL_CSV/hyp1/THREEdata.csv")

THREENitrateDV <- THREEdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

THREEFlowDV <- THREEdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

THREEChemo <- full_join(THREENitrateDV, THREEFlowDV, by = "dateTime")

THREEChemoplot <- ggplot(THREEChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Three Mile Canal")+
  theme(plot.title = element_text(size = 12))


#TURK
TURKdata <- read.csv("../FL_CSV/hyp1/TURKdata.csv")

TURKNitrateDV <- TURKdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

TURKFlowDV <- TURKdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

TURKChemo <- full_join(TURKNitrateDV, TURKFlowDV, by = "dateTime")

TURKChemoplot <- ggplot(TURKChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Turkey Creek")+
  theme(plot.title = element_text(size = 12))


#TURN
TURNdata <- read.csv("../FL_CSV/hyp1/TURNdata.csv")

TURNNitrateDV <- TURNdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

TURNFlowDV <- TURNdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

TURNChemo <- full_join(TURNNitrateDV, TURNFlowDV, by = "dateTime")

TURNChemoplot <- ggplot(TURNChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Turnbull Creek")+
  theme(plot.title = element_text(size = 12))

#WAC
WACdata <- read.csv("../FL_CSV/hyp1/WACdata.csv")

WACNitrateDV <- WACdata %>%
  group_by(dateTime) %>%
  summarise(Nitrate_DV = mean(Nitrate_mgl))

WACFlowDV <- WACdata %>%
  group_by(dateTime) %>%
  summarise(Flow_DV = mean(Flow_Inst))

WACChemo <- full_join(WACNitrateDV, WACFlowDV, by = "dateTime")

WACChemoplot <- ggplot(WACChemo, aes(x = Flow_DV, y = Nitrate_DV)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "", y = "") +
  ggtitle("Wacissa River") +
  theme(plot.title = element_text(size = 12))


y.grob <- textGrob("Daily Mean Nitrate (mg/l)", 
                   gp=gpar(fontface="bold", fontsize=12), rot=90)

x.grob <- textGrob(("Daily Mean Discharge (ft3/s)"), 
                   gp=gpar(fontface="bold", fontsize=12))

diluting.grob <- textGrob("Diluting Systems C-Q",
                          gp=gpar(fontface="bold", fontsize=15))
flushing.grob <- textGrob("Flushing Systems C-Q",
                          gp=gpar(fontface="bold", fontsize=15))
chemostatic.grob <- textGrob("Chemostatic Systems C-Q",
                             gp=gpar(fontface="bold", fontsize=15))
```

```{r, echo = FALSE, message = FALSE,warning = FALSE, fig.cap="C-Q Plots of Chemostatic Sites",fig.height=5}

ChemostaticPlot <- plot_grid(
  FANChemoplot, RAINChemoplot, CHASChemoplot,  
  TURNChemoplot, WACChemoplot,
  ncol = 3)
grid.arrange(arrangeGrob(ChemostaticPlot, left = y.grob, bottom = x.grob, top = chemostatic.grob))
```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.cap="C-Q Plots of Flushing Sites",fig.height=5}
FlushingPlot <- plot_grid(
  MAINChemoplot, FELLChemoplot, CRANEChemoplot, MADChemoplot, 
  THREEChemoplot, CALChemoplot, HUNChemoplot,
  ncol = 3
)
grid.arrange(arrangeGrob(FlushingPlot, left = y.grob, bottom = x.grob, top = flushing.grob))

```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.cap="C-Q Plots of Diluting Sites",fig.height=5}
DilutingPlot <- plot_grid(
  ICHEChemoplot, SANTAChemoplot, BLUEChemoplot, HOLChemoplot, DRAINChemoplot, 
  BOWChemoplot,  MANChemoplot, HOMChemoplot, TURKChemoplot,
  ncol = 3
)
grid.arrange(arrangeGrob(DilutingPlot, left = y.grob, bottom = x.grob, top = diluting.grob))

```

### Quantitative/Statistical Approach: How do counties’ population and water usage impact the chemical flashiness of sites within the county?


```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=4, fig.width = 9}
pop.plot.2 = ggplot(hyp2.full_cleaned, aes(x = total_pop, y = abschemo)) +
  geom_point(aes(color = site.type)) +
  geom_smooth(method = "lm") +
  labs(x = "Population of the county (k people)", y = "Absolute Chemostatic Coefficient (slope from regression)")+
  theme(title = element_text(size = 8),
        plot.margin = margin(0,0,0,0))

irri.plot.2 = ggplot(hyp2.full_cleaned, aes(x = irrigation, y = abschemo)) +
  geom_point(aes(color = site.type)) +
  geom_smooth(method = "lm") +
  labs(x = "Irrigation water use (Bgal/d)", y = "")+
    theme(title = element_text(size = 8),
        plot.margin = margin(0,0,0,0),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())


therm.plot.2 = ggplot(hyp2.full_cleaned, aes(x = thermoelectric, y = abschemo)) +
  geom_point(aes(color = site.type)) +
  geom_smooth(method = "lm") +
  labs(x = "Power gen. water use (Bgal/d)", y = "")+
    theme(title = element_text(size = 8),
        plot.margin = margin(0,0,0,0),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())
legend <- get_legend(
  # create some space to the left of the legend
  pop.plot.2 + theme(legend.box.margin = margin(0, 0, 0, 0))
)

title <- ggdraw() + 
  draw_label(
    "Impact of Population and Water Use on Abs. Chemostatic Coeff.",
    fontface = 'bold',
    x = 0,
    hjust = 0
  ) +theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 0)
  )
plot_row <- plot_grid(pop.plot.2 + theme(legend.position="none"),
          irri.plot.2+ theme(legend.position="none"),
          therm.plot.2+ theme(legend.position="none"), legend, ncol = 4)

plot_grid(title, plot_row, ncol = 1,rel_heights = c(0.1, 1))
```

```{r, echo = FALSE, message = FALSE, fig.height=4, fig.width = 9}
hyp2.plot.2 <- ggplot() +
  geom_sf(data = HUC6.Florida, color = "darkgray", alpha = 0.5)+
  geom_sf(data = waterfeatures, aes(fill = FEATURE, color = FEATURE, show.legend = "fill")) +
  geom_sf(data = hyp2.spatial, aes(size = abschemo), alpha = 0.5, show.legend = "point") +
 # scale_color_viridis_c(option = "inferno") +
  labs(size = "Chemo staticity") +
  theme(legend.position = "right",
        legend.text = element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.margin = margin(0,0,0,0))
print(hyp2.plot.2)
```


\newpage

# Summary and Conclusions
<Summarize your major findings from your analyses in a few paragraphs. What conclusions do you draw from your findings? Relate your findings back to the original research questions and rationale.>

\newpage

# References
<add references here> 
Chislock, M. F., Doster, E., Zitomer, R. A. & Wilson, A. E. (2013) Eutrophication: Causes, Consequences, and Controls in Aquatic Ecosystems. Nature Education Knowledge 4(4):10

Smith, V. H. & Schindler, D. W. Eutrophication science: where do we go from here? Trends in Ecology and Evolution 24, 201-207 (2009).

Stephenson, C. “Addressing Eutrophication in Florida, one watershed at a time.” University of Florida: IFAS Extension. July 23, 2018. Web: https://nwdistrict.ifas.ufl.edu/nat/2018/07/23/addressing-eutrophication-in-florida-one-watershed-at-a-time/.

